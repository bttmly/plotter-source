// Generated by CoffeeScript 1.7.1
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  (function(root, factory) {
    if (typeof define === "function" && define.amd) {
      define(["exports"], function(exports) {
        root.Controls = factory(root, exports);
      });
    } else if (typeof exports !== "undefined") {
      factory(root, exports);
    } else {
      root.Controls = factory(root, {});
    }
  })(this, function(root, Controls) {
    var BaseControl, ButtonControl, CheckableControl, ControlCollection, SelectControl, buildControlObject, controlFactory, each, filter, qs, qsa, slice;
    qs = document.querySelector.bind(document);
    qsa = document.querySelectorAll.bind(document);
    each = Function.prototype.call.bind(Array.prototype.forEach);
    slice = Function.prototype.call.bind(Array.prototype.slice);
    filter = Function.prototype.call.bind(Array.prototype.filter);
    BaseControl = (function() {
      function BaseControl(el) {
        this.el = el;
        this.id = el.id;
        this.listeners = [];
      }

      BaseControl.prototype.required = function(param) {
        if (arguments.length) {
          this.el.required = !!param;
          return this;
        } else {
          return this.el.required;
        }
      };

      BaseControl.prototype.disabled = function(param) {
        if (arguments.length) {
          this.el.disabled = !!param;
          return this;
        } else {
          return this.el.disabled;
        }
      };

      BaseControl.prototype.value = function(param) {
        if (arguments.length) {
          this.el.value = param;
          return this;
        } else if (this.valid()) {
          return this.el.value;
        }
      };

      BaseControl.prototype.valid = function() {
        if (this.el.checkValidity) {
          return this.el.checkValidity();
        } else {
          return true;
        }
      };

      BaseControl.prototype.on = function(eventType, handler) {
        this.el.addEventListener(eventType, handler);
        return this;
      };

      BaseControl.prototype.off = function(handler) {
        this.el.removeEventListener(handler);
        return this;
      };

      BaseControl.prototype.trigger = function(eventType) {
        this.el.dispatchEvent(new CustomEvent(eventType));
        return this;
      };

      return BaseControl;

    })();
    CheckableControl = (function(_super) {
      __extends(CheckableControl, _super);

      function CheckableControl(el) {
        CheckableControl.__super__.constructor.call(this, el);
      }

      CheckableControl.prototype.value = function(param) {
        if (param) {
          this.el.value = param;
          return this;
        } else {
          if (this.el.checked) {
            return this.el.value;
          } else {
            return false;
          }
        }
      };

      return CheckableControl;

    })(BaseControl);
    SelectControl = (function(_super) {
      __extends(SelectControl, _super);

      function SelectControl(el) {
        SelectControl.__super__.constructor.call(this, el);
      }

      SelectControl.prototype.value = function() {
        var option, results, _i, _len, _ref;
        results = [];
        _ref = this.selected();
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          option = _ref[_i];
          if (option.value) {
            results.push(option.value);
          }
        }
        return results;
      };

      SelectControl.prototype.selected = function() {
        return filter(this.el.querySelectorAll("option"), function(opt) {
          return opt.selected && opt.value && !opt.disabled;
        });
      };

      return SelectControl;

    })(BaseControl);
    ButtonControl = (function(_super) {
      __extends(ButtonControl, _super);

      function ButtonControl(el) {
        ButtonControl.__super__.constructor.call(this, el);
      }

      return ButtonControl;

    })(BaseControl);
    ControlCollection = (function(_super) {
      __extends(ControlCollection, _super);

      function ControlCollection(components, options) {
        var component, _i, _len;
        for (_i = 0, _len = components.length; _i < _len; _i++) {
          component = components[_i];
          this.push(component);
        }
        this.id = options.id;
        this.listners = {};
      }

      ControlCollection.prototype.value = function() {
        var component, val, values, _i, _len;
        values = [];
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          val = component.value();
          if (val && val.length) {
            values.push({
              id: component.id,
              val: val
            });
          }
        }
        return values;
      };

      ControlCollection.prototype.valueArray = function(deep) {
        var component, values, _i, _len;
        values = [];
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          if (deep) {
            values.push(component.valueArray() || component.value());
          } else {
            values.push(component.value());
          }
        }
        return values;
      };

      ControlCollection.prototype.disabled = function(param) {
        var component, results, _i, _len;
        results = {};
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          if (param != null) {
            component.disabled(param);
          }
          results[component.id] = component.disabled();
        }
        return results;
      };

      ControlCollection.prototype.required = function(param) {
        var component, results, _i, _len;
        results = {};
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          if (param != null) {
            component.required(param);
          }
          results[component.id] = component.required();
        }
        return results;
      };

      ControlCollection.prototype.on = function(eventType, handler) {
        var component, _i, _len;
        handler = handler.bind(this);
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          component.on(eventType, handler);
        }
        return this;
      };

      ControlCollection.prototype.off = function(handler) {
        var component, _i, _len;
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          component.off(arguments);
        }
        return this;
      };

      ControlCollection.prototype.trigger = function(eventType, handler) {
        var component, _i, _len;
        handler = handler.bind(this);
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          component.trigger(arguments);
        }
        return this;
      };

      ControlCollection.prototype.getComponentById = function(id) {
        var component, _i, _len;
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          component = this[_i];
          if (component.id === id) {
            return component;
          }
        }
        return false;
      };

      ControlCollection.prototype._addListener = function(eventType, listener) {
        if (!this.listeners[eventType]) {
          this.listeners[eventType] = [];
        }
        return this.listeners[eventType].push(listener);
      };

      return ControlCollection;

    })(Array);
    buildControlObject = function(el) {
      switch (el.tagName) {
        case "INPUT":
          if (el.type === "radio" || el.type === "checkbox") {
            return new CheckableControl(el);
          } else {
            return new BaseControl(el);
          }
          break;
        case "SELECT":
          return new SelectControl(el);
        case "BUTTON":
          return new ButtonControl(el);
      }
    };
    controlFactory = function(e, options) {
      var buildOptions, components, factoryInner, tagNames;
      components = [];
      tagNames = ["INPUT", "SELECT", "BUTTON"];
      factoryInner = function(elParam) {
        var els, _ref;
        if (elParam instanceof ControlCollection) {
          components.push(elParam);
          return;
        } else if (typeof elParam === "string") {
          factoryInner(qsa(elParam));
          return;
        } else if (elParam instanceof Node && !(_ref = elParam.tagName, __indexOf.call(tagNames, _ref) >= 0)) {
          els = [];
          each(tagNames, function(name) {
            els = els.concat(slice(elParam.getElementsByTagName(name)));
          });
          factoryInner(els);
          return;
        } else if (elParam instanceof Node) {
          components.push(buildControlObject(elParam));
          return;
        } else if (typeof elParam.length !== "undefined") {
          each(elParam, function(item) {
            factoryInner(item);
          });
          return;
        } else {
          console.warn("Factory call fell through.");
        }
      };
      factoryInner(e);
      options || (options = {});
      buildOptions = {};
      buildOptions.id = options.id || (function() {
        if (e instanceof Node) {
          return e.getAttribute(controlFactory.identifyingAttribute);
        } else if (typeof e === "string") {
          if (e.charAt(0 === "#" || e.charAt(0 === "."))) {
            return e.substr(1);
          } else {
            return e;
          }
        }
      })();
      return new ControlCollection(components, buildOptions);
    };
    controlFactory.identifyingAttribute = "id";
    controlFactory.version = "0.2.0";
    return controlFactory;
  });

}).call(this);
